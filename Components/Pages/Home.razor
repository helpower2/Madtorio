@page "/"
@using Madtorio.Services
@inject IRulesService RulesService
@rendermode InteractiveServer

<PageTitle>Madtorio - Factorio Community</PageTitle>

<div class="hero">
    <h1>Welcome to Madtorio</h1>
    <p>Your Factorio community hub for save files, builds, and automation</p>
    <a href="https://tinyurl.com/madtorio-server" target="_blank" class="btn btn-lg" style="margin-right: 1rem;">
        Join Our Discord Server
    </a>
    <a href="/downloads" class="btn btn-lg btn-secondary">
        Browse Save Files
    </a>
</div>

@if (!string.IsNullOrEmpty(serverIp))
{
    <div class="row mt-4">
        <div class="col-12">
            <div class="card server-highlight">
                <div class="card-header">
                    <h3>Join Our Factorio Server</h3>
                </div>
                <div class="card-body text-center">
                    <p>Connect to our dedicated Factorio server and build with the community:</p>
                    <h2 class="text-orange mb-3">@serverIp</h2>
                    <a href="/server-info" class="btn">Connection Guide</a>
                </div>
            </div>
        </div>
    </div>
}

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3>Community Builds</h3>
            </div>
            <div class="card-body">
                <p>Explore save files from the Madtorio community. Learn from expert factory designs, download blueprints, and share your own creations.</p>
                <a href="/downloads" class="btn">View Downloads</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3>Join Discord</h3>
            </div>
            <div class="card-body">
                <p>Connect with fellow engineers on our Discord server. Discuss strategies, share designs, and collaborate on massive factory projects.</p>
                <a href="https://tinyurl.com/madtorio-server" target="_blank" class="btn">Join Now</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h3>Community Rules</h3>
            </div>
            <div class="card-body">
                <p>Read our community guidelines to ensure a positive experience for all engineers. Respect, collaboration, and automation above all.</p>
                <a href="/rules" class="btn">Read Rules</a>
            </div>
        </div>
    </div>
</div>

<footer class="mt-5">
    <p>Madtorio - A Factorio Community | The factory must grow!</p>
</footer>

@code {
    private string? serverIp;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            serverIp = await RulesService.GetServerConfigAsync("ServerIP");
        }
        catch (Exception ex)
        {
            // Log error but don't show to user
            Console.WriteLine($"Error loading server IP: {ex.Message}");
        }
    }
}
